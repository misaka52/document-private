### java基础

1. hashmap实现？hash冲突？
2. 并发锁有哪些？介绍下AQS的功能？
   1. AQS功能：管理任务同步状态、管理等待队列、唤醒或阻塞线程
3. ConcurrentHashMap结构，读和写实现？当扩容时读和写的表现？
   1. 扩容时读发现扩容节点则更换新表表读，写发现扩容节点时则帮助扩容
4. TreeMap结构，如何实现？
   1. 待办？
5. LinkedHashMap实现
   1. 待办？
6. 线程池介绍：核心数，工作模式？介绍常见的几种线程池？如何选择线程池，如何配置参数？
   1. 推荐使用自定义线程池
7. 解决哈希冲突的方法
   1. 链地址法，开放地址法（跨一步，跨多步），再哈希法（提供多种哈希函数）
8. 动态代理的两种实现
9. @Transactional失效
   1. 非public方法失效。当所有的方法都不是public的@Transactional方法时，不会创建代理对象。
   2. 在类内部调用本类的@Transactional方法失效
   3. 未抛出指定的异常时失效（默认捕获RuntimeException）
   4. 采用多数据源失效？具体怎么体现，事务不生效还是部分生效，事务的传播性？
10. 一致性哈希算法
11. gc
    1. Minor gc：当新建对象放入年轻代时，空间不足产生minor gc
    2. major gc：回收老年代
    3. full gc：minor gc + major gc。回收年轻代、老年代、元空间
12. 类加载
    1. 类加载流程：加载、验证、准备、解析、初始化
    2. 类加载机制：双亲委派机制。优势：避免类重复加载，加载过不会再加载；避免核心类库被修改

### Spring

1. spring功能简介
2. springboot bean自动装配机制
3. spring用到了哪几种设计模式
   1. 工厂模式。可通过BeanFactory或ApplicationContext创建bean对象
   2. 单例模式。bean默认都是单例。五种实现
   3. 代理模式。动态代理：jdk代理和cglib代理
   4. 模板方法模式。spring中设置了一套公用的模板，根据不同的实现类的调用不同方法
   5. 观察者模式。ApplicationEvent充当事件的角色，ApplicationListener充当事件监听者角色，分别继承这两个类，实现applicationContext配置更新动态监听
      1. `ContextStartedEvent`：`ApplicationContext` 启动后触发的事件;
      2. `ContextStoppedEvent`：`ApplicationContext` 停止后触发的事件;
   6. 适配器模式。如springmvc中根据handler获取handlerAdapter

### jvm

1. 内存区域？jdk1.8元空间？
   1. 使用元空间代替永久代
2. 如何判断对象是否能被回收？垃圾回收算法
   1. 引用计数法和可达性分析法
3. 堆的分区？full gc有哪些场景？
   1. Eden，survivor。
   2. full gc：老年代空间不足fg；元空间空间不足fg；手动调用System.gc()进行fg
4. CMS垃圾收集器？jvm停顿时机，为什么要停顿
   1. 重新标记停顿：解决因并发标记时用户线程同步进行而发生变化的引用，重新扫描这些增加了从黑色节点到白色节点引用的黑色节点。进行重新扫描，以避免存活的对象被回收
5. G1垃圾收集器？jvm停顿时机，为什么要停顿
   1. 回收时停顿：回收时需要将region中存活对象移动到空region，涉及到对象的移动，因此需要停顿

### Redis

1. 分布式锁实现原理？还有别的实现方式吗？
   1. 分布实现原理：set nx px或setnx + expire并结合lua脚本。可以参考Redission
   2. 更多实现方式：数据库实现（唯一索引。考虑到键的过期，可以增加时间戳字段）、zookeeper实现
2. 分布式锁键值过期，业务还未执行完，怎么办？
   1. 增加守护线程，定时延长过期时间
3. redis分布式锁主从模式下，主节点为同步从节点就宕机，导致丢失分布式锁键值，如何解决该问题？
   1. 引入redlock算法，尽可能地保证高可用
4. redis为什么这么快？为什么使用单线程？
   1. 基于内存操作；使用单线程；C语言实现；数据结构简单
   2. 单线程：较少线程间切换消耗；单线程也能并发处理请求，通过多路复用机制；性能瓶颈一般不在cpu而在网络、内存、磁盘
5. redis事务？
   1. 具有事务：当事务中出现编译错误时，整个事务都不执行；当出现运行错误时，执行全部指令
   2. 可以通过watch和multi实现事务：watch乐观锁监测一个键，当遇到exec是提交，若期间键有变更，则事务不生效
6. redis如何实现持久化
   1. rdb和aof：rdb在指定时间内修改一数量键则进行rdb（save 900 1）；aof分为每次修改触发aof、每秒一次触发aof、不触发aof、
   2. rdb：save同步保存，bgsave异步保存。异步保存时通过fork一个子进程进行备份，生成一个临时文件，将**内存中全部数据**复制到临时文件中，备份完成则用新的临时文件替换老的dump.rdb文件
7. 如何筛选热点数据？
   1. 使用lfu算法作用缓存淘汰策略，redis4.0版本引入

### mysql

1. mysql索引结构？为什么选择B+树？
   1. B+树非叶子节点更小，内存中可以载入更多的节点，树更加矮胖，产生IO次数少；支持范围查询；更容易命中缓存
   2. 哈希索引，当批量查询数据时可能产生更多的磁盘IO
   3. B树，需要更多次数的磁盘IO
2. sql语句分析？explain详述
   1. key实际使用键，extra参数分析
3. 索引创建时机？索引优化？索引失效时机？
4. mysql事务如何实现？
   1. 锁实现隔离性；redo实现原子性和持久性；undo实现一致性
5. MVCC机制
   1. 通过设置保存数据的多个版本实现非锁定的一致性读。实现：记录隐藏字段、undo、readview
6. 事务隔离级别？mysql的锁介绍
   1. 表结构锁：共享锁、排他锁、意向共享锁、意向排他锁、自增锁、元数据锁
   2. 行结构锁：共享锁、排他锁、插入意向锁
   3. 行范围锁：记录锁、间隙锁、临键锁
7. 对于多个大表的连表查询，有什么优化？
   1. 对连接字段建立索引，避免全表查询
   2. 小表驱动大表
   3. 避免使用not in，不等号，like通配符开头，字段类型不匹配，算术公式的操作
   4. 当内层表数据量小时使用in，数据量大时使用exists
   5. 分库分表
   6. 分为多次查询
8. on duplicate key update 死锁问题
   1. 并发量大时可能存在，未压测复现该问题？？
9. select * 和select 列表区别，及内部原理实现区别？没找到
10. 数据库连接池
    1. 管理数据库连接，数据库连接需要与数据库建立TCP连接
    2. 官方推荐使用hikari，hikari性能最好，druid在监控方便做的较好

### RocketMQ

1. 项目架构？选择RocketMQ的原因？
2. 消息丢失的场景
3. 事务消息原理
4. nameserver之间是否存在不一致性？
   1. ？？？
5. 说下你觉得RocketMQ设计的最好的点
   1. 文件存储是一个靓点：文件大小固定；commitlog末尾空白补齐；commitLog文件顺序写入消息；consumeQuque索引文件按照topic+消费者保存消息；indexFile保存索引文件；保存多台消费进度来实现多套group消费同一套消息；消息过期清理机制，避免无限积压
6. 一个group是否可以订阅多个topic
   1. 物理上可以，但是不推荐这么做，会导致topic订阅关系紊乱，无法正常消费
7. RocketMQ问题
   1. 消息重复消费
   2. 消息可能丢失（机器磁盘、cpu、主板、内存等损坏）。可以设置成集群模式，同步刷盘，保证消息的稳定可靠性
   3. 并发消息消费乱序
8. RocketMQ高可用问题保障
   1. 多Master，每个Master携带slave
   2. 主从之间设置为SYNC_MASTER(同步负责，ASYNC_MASTER表示异步复制，无需等待master复制到slave即可直接返回ack)，同步复制当master同步到一个slave即可返回成功（返回SEND_OK），暂不支持同步半数以上即成功的配置。
   3. producer采用同步发送消息
   4. 刷盘策略改为SYNC_FLUSH

### 设计模式

1. 讲下常用的几种设计模式及使用场景
   1. 单例、责任链、模范方法、策略、构建者、代理、适配器

### 项目问题

1. 项目架构实现？个人负责内容
   1. springboot+k8s。全流程参与，主要负责签约&承保
2. 项目中自己做的最难的内容，或做的最好的内容？做的不好的地方？
   1. 靓点：
      1. 承保的多级过滤，redis多级缓存+本地缓存（RMQ实现），实现流量漏斗方式过滤
      2. 签约时责任链模式的开发
3. 项目中遇到的困难？如何解决
   1. 长链路批处理模式解决
   2. 多级缓存+本地缓存实现
4. 项目中做了什么优化内容？后续有什么优化内容？
   1. 优化点：
      1. 缓存+本地缓存设计；
      2. sql优化，添加索引；
      3. 接单套mq设计：接入一套mq，通过险种过滤，获取命中险种，计算险种标记值，保存入库。后续通过定时任务扫描去进行后续险种任务，若承保完成通过位数组方式更新数据
   2. 待优化点
      1. 配置化优化
      2. 性能监控、日志打印、邮件设计

### 算法题

1. 设计一个栈，要求提供一个min()函数获得栈最小元素，时间复杂度O(1)？优化：pop()和push()时间复杂度也为O(1)
2. 给定一个字符串，找出最长非重复的子串的长度
   1. 字典表实现最优
3. 给定一个1G的文件，文件内部都是不重复的数字，如何通过给定的250M的内存，实现数字快速排序
   1. 简单实现：首先按照给定250M内存实现局部文件排序，生成四个文件。然后采用四路归并思想，将内存分为5块，一块作为写入缓存（可以小点），每一块内存负责读取对应文件，每次在内存中比较获得最大值，保存到写缓存区，生成最终排序文件
   2. 更优实现：注意不重复。采用位图法，每个整型数字表示32位，即最多可表示32个数字，将每个数字计算出对应标志位标记，记录下来，最终对所有数据计算，获得排序列表的数据。若数据存在重复比较少次数的情况，也可采用位图法，比如每个重复数字最多不超过10个，则可以利用4位来表示数字的出现次数

### 设计

1. 设计一个秒杀系统
   1. 分流：分为多台服务器
   2. 限流：限制单机最大并发量。
   3. 部分失败：部分请求直接返回失败
   4. 用户防刷机制
   5. 业务隔离：先报名才能参加，也可做缓存预热；环境隔离：搭建新环境；数据隔离：数据单独的mysql和redis
   6. 前端浏览器缓存；CDN缓存
   7. 动静分离，静态数据直接读缓存，动态数据走缓存+答题限制
   8. 缓存：不要求强一致性
   9. 写数据库：要求强一致性
   10. 秒杀答题时间片削峰：将短时流量拆分到更长时间段的流量
2. 如何设计规则引擎，需要注意的问题？用到的设计模式？
3. 如何增加原接口的功能？
   1. aop实现，代理模：比如日志打印、数据统计、性能监控
   2. 拦截器：登录态验证，权限验证
   3. 过滤器：可拦截静态资源
4. 给定用户的运动记录，一位用户一次运动作为一次记录，如何设计实现可以搜索用户运动量全球排名？如何按照月，周，日实现运动量排名
   1. 可按照最细粒度，比如设计一张小时活跃表，每小时执行一次定时任务，统计过期一小时内用户的总运动量，对运动量建立索引。还可以增加日活跃表、周活跃表，以实现快速统计排名。
   2. 若想获取实时数据，可以设置实时活跃数据表，比如每5秒更新一次，通过后台定时任务更新
5. 幂等实现：指同一请求重复处理N次都得到一样的结果。场景：接口处理超时
   1. 客户端控制：前端控制好不可重复请求
   2. 通用方式：通过新增记录表，以请求的唯一键（一般有设置source和seq两个字段）保存在记录表或redis中，每次处理请求时，先查询请求是否处理过，若处理过直接返回结果；若未处理过则处理请求，将结果放入记录表或redis中。数据量可能无限累加，可以定时清理数据
   3. 通过数据库的唯一约束实现，适合新增数据：根据业务键设置唯一索引，插入失败则表示也处理过。和2类似
   4. 乐观锁：通过CAS无锁方式更新数据，可以拿时间戳作为版本字段
   5. 分布式锁：控制不能重复提交ß
   6. token机制：客户端请求页面时，服务端生成一个随机数作为token返回，token存放在redis中，后续请求中携带token提交请求，当第一次请求时删除token，返回true则表示正常处理请求，若返回false则表示重复请求或无效请求
   7. select+insert：适用于并发较小的系统，先查后插
   8. 状态机：设置多状态，比如订单状态，通过cas更新订单状态，保证幂等性

### 中间件

1. Shardingjdbc：架构？如何sql改写？
   1. sql改写：比如排序列补充（select A .. order by B），limit改写、其他改写（avg()改为先获取字表总数量和总函数，最后归并算结果）
   2. 不支持项
      1. insert value不支持算术表达书（1+2）
      2. 时间字段转换不支持，会导致全表路由。to_date(create_time, 'yyyyMMdd')=?
      3. having、union、union all、distinct(同时使用普通聚合函数和distinct聚合函数)、schema、insert..select
      4. 存储过程、函数、游标、savepoint、timeout操作
2. xxl-job：如何实现注册，调度功能
3. apollo：如何实现配置更新

### 其他问题

1. 项目组人员组成，有哪些级别的人？你和同级别的对比有什么优势？
2. 在项目组担任何种角色，做哪些事？
3. 找出反驳项目经理/产品经理的需求的一两点，反驳的理由？
4. 目前遇到的最大困难？如何应对和解决？
5. 离职原因
6. 个人优缺点
7. 未来规划
8. 期望薪资
9. 平时生活时间如何规划？都看哪些书籍
10. 向面试官提问

